<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Speaker Isolation & Transcription</title>
	<link rel="stylesheet" href="/static/styles.css" />
</head>
<body>
	<div class="container">
		<div class="header">
			<div class="brand">Speaker Isolation & Transcription</div>
			<div class="sub">Upload audio • Separate speakers • Get transcripts</div>
		</div>

		<div class="card">
			<form id="upload-form" action="/" method="post" enctype="multipart/form-data">
				<div class="grid grid-2">
					<div>
						<div class="label">Audio file</div>
						<div id="dropzone" class="dropzone">
							<p>Drag & drop an MP3/WAV here, or click to choose</p>
							<input id="file-input" class="input" type="file" name="audio" accept="audio/*" required style="display:none;" />
							<div id="file-name" class="sub"></div>
						</div>
					</div>
					<div>
						<div class="label">Number of speakers</div>
						<select class="select" name="num_speakers">
							<option value="2" selected>2</option>
							<option value="3">3</option>
						</select>
						<div class="label" style="margin-top:10px;">Whisper model</div>
						<select class="select" name="whisper_model">
							<option value="tiny">tiny</option>
							<option value="base" selected>base</option>
							<option value="small">small</option>
							<option value="medium">medium</option>
							<option value="large">large</option>
						</select>
					</div>
				</div>
				<div style="margin-top:16px; display:flex; gap:10px;">
					<button id="submit-btn" class="button" type="submit">
						<span class="center"><span class="spinner" id="spinner" style="display:none;"></span>Process</span>
					</button>
					<button class="button secondary" type="reset" id="reset-btn">Reset</button>
				</div>
			</form>
		</div>

		{% if error %}
			<p class="sub" style="color:#ffb3b3; margin-top:12px;">{{ error }}</p>
		{% endif %}

		<p class="footer">Models are downloaded on first use. Processing time depends on audio length.</p>
	</div>

	<script>
	(function(){
		const dropzone = document.getElementById('dropzone');
		const fileInput = document.getElementById('file-input');
		const fileName = document.getElementById('file-name');
		const form = document.getElementById('upload-form');
		const submitBtn = document.getElementById('submit-btn');
		const spinner = document.getElementById('spinner');
		const resetBtn = document.getElementById('reset-btn');

		dropzone.addEventListener('click', () => fileInput.click());
		dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
		dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
		dropzone.addEventListener('drop', (e) => {
			e.preventDefault();
			dropzone.classList.remove('dragover');
			if (e.dataTransfer.files && e.dataTransfer.files[0]) {
				fileInput.files = e.dataTransfer.files;
				fileName.textContent = e.dataTransfer.files[0].name;
			}
		});
		fileInput.addEventListener('change', () => {
			if (fileInput.files && fileInput.files[0]) {
				fileName.textContent = fileInput.files[0].name;
			}
		});

		form.addEventListener('submit', () => {
			submitBtn.disabled = true;
			spinner.style.display = 'inline-block';
		});

		resetBtn.addEventListener('click', () => {
			fileInput.value = '';
			fileName.textContent = '';
			submitBtn.disabled = false;
			spinner.style.display = 'none';
		});
	})();
	</script>
</body>
</html>
